# frozen_string_literal: true

require 'net/http'
require 'uri'

# This class contains the request for the website
class Request < ComprehensiveScan
  def initialize(url)
    @url = url
    @headers = {}
    @cookies = {}
    @user_agent = 'Mozilla/5.0'
    @follow_redirects = true
    fetch_requests
  end

  def fetch_requests # rubocop:disable Metrics/AbcSize
    uri = URI.parse(@url)
    http = Net::HTTP.new(uri.host, uri.port)
    http.use_ssl = (uri.scheme == 'https')

    request = Net::HTTP::Get.new(uri.request_uri)
    @headers.each { |key, value| request[key] = value }
    request['Cookie'] = @cookies.map { |k, v| "#{k}=#{v}" }.join('; ') unless @cookies.empty?
    request['User-Agent'] = @user_agent unless @user_agent.empty?

    @response = http.request(request)
  end

  def show_requests
    puts "Request URL: #{@url}"
    puts "Request Headers: #{@headers.empty? ? 'None' : @headers}"
    puts "Request Cookies: #{@cookies.empty? ? 'None' : @cookies}"
    puts "User Agent: #{@user_agent}"
    puts "Follow Redirects: #{@follow_redirects}"
    puts "Response Code: #{@response.code}"
    puts "Response Message: #{@response.message}"
    puts "Response Body: #{@response.body[0..500]}..." # Displaying first 500 characters of the response body
  end
end
